<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>正则表达式测试器 · BoolTox</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <header class="app-header">
      <div>
        <h1>正则表达式测试器</h1>
        <p>Node.js 后端 + JSON-RPC · 超时保护 · 实时高亮</p>
      </div>
      <div class="status">
        <span id="status-dot" class="status-dot"></span>
        <span id="status-label">后端未连接</span>
        <button id="restart-btn" class="ghost" style="margin-left: 12px;">重新连接</button>
        <button id="stop-btn" class="ghost">断开</button>
      </div>
    </header>

    <div class="layout">
      <section class="panel stack">
        <div>
          <h2>正则编辑器</h2>
          <label for="pattern-input" style="display:block;margin-bottom:6px;color:var(--muted);">Pattern</label>
          <textarea id="pattern-input" placeholder="请输入正则表达式，支持命名捕获"></textarea>
          <div style="margin:12px 0; display:flex; justify-content:space-between; align-items:center;">
            <div class="flag-group" id="flag-group">
              <button type="button" class="flag-btn" data-flag="g">g</button>
              <button type="button" class="flag-btn" data-flag="i">i</button>
              <button type="button" class="flag-btn" data-flag="m">m</button>
              <button type="button" class="flag-btn" data-flag="s">s</button>
              <button type="button" class="flag-btn" data-flag="u">u</button>
            </div>
            <button id="validate-btn" class="secondary" style="min-width:120px;">语法校验</button>
          </div>
          <div id="validate-result" style="font-size:13px;color:var(--muted);"></div>
        </div>

        <div>
          <h2>常用模式</h2>
          <div class="template-list" id="pattern-list"></div>
        </div>

        <div>
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <h2>历史记录</h2>
            <button id="clear-history" class="ghost" style="padding:6px 10px;font-size:12px;">清空</button>
          </div>
          <div class="history-list" id="history-list"></div>
        </div>
      </section>

      <section class="main-panel">
        <div class="panel">
          <h2>测试文本</h2>
          <textarea id="test-text" placeholder="粘贴或输入要匹配的文本"></textarea>
          <label for="replacement-input" style="display:block;margin:12px 0 6px;color:var(--muted);">替换模板（支持 $1、$<name>）</label>
          <input id="replacement-input" placeholder="请输入替换字符串" />
          <div class="actions" style="margin-top:16px;">
            <button id="run-test">运行匹配</button>
            <button id="run-replace" class="secondary">执行替换</button>
          </div>
          <div id="banner" class="banner"></div>
        </div>

        <div class="panel">
          <h2>结果概览</h2>
          <div class="summary-grid">
            <div class="metric">
              <span>匹配总数</span>
              <strong id="summary-total">-</strong>
            </div>
            <div class="metric">
              <span>唯一匹配</span>
              <strong id="summary-unique">-</strong>
            </div>
            <div class="metric">
              <span>耗时 (ms)</span>
              <strong id="summary-time">-</strong>
            </div>
            <div class="metric">
              <span>捕获组</span>
              <strong id="summary-groups">-</strong>
            </div>
          </div>
          <div style="margin-top:16px;">
            <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
            <div style="font-size:12px;color:var(--muted);margin-top:6px;" id="progress-label">等待任务</div>
          </div>
        </div>

        <div class="panel">
          <h2>高亮预览</h2>
          <div id="highlight-preview" class="highlight-preview">尚无匹配，点击“运行匹配”查看结果。</div>
        </div>

        <div class="panel">
          <h2>匹配详情</h2>
          <div class="matches" id="match-list"></div>
        </div>

        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h2>替换预览</h2>
            <button id="copy-replace" class="ghost" style="padding:6px 10px;font-size:12px;">复制预览</button>
          </div>
          <div id="replacement-meta" style="font-size:12px;color:var(--muted);margin:8px 0 12px;"></div>
          <div class="replacement" id="replacement-preview">暂无替换输出</div>
        </div>
      </section>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
